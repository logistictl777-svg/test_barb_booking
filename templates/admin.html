<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>Admin panel</title>
<link rel="stylesheet" href="{{ url_for('static', path='style.css') }}">
</head>

<body>

<header class="header">
    <div class="logo">üîê Admin panel</div>
    <a href="/" class="admin-link">–ù–∞ —Å–∞–π—Ç</a>
</header>

<section class="booking-container">
<div class="booking-card">

<h2>–£—Å—ñ –∑–∞–ø–∏—Å–∏</h2>

<button class="next-btn" onclick="logout()" style="margin-bottom:20px">
–í–∏–π—Ç–∏
</button>

<div id="bookings"></div>

</div>
</section>

<script>
async function logout(){
  await fetch("/logout",{credentials:"include"});
  window.location="/";
}

async function loadBookings(){
  const res = await fetch("/admin/bookings",{
    credentials:"include"
  });

  const bookings = await res.json();
  const container = document.getElementById("bookings");
  container.innerHTML="";

  bookings.forEach(b=>{
    const div=document.createElement("div");
    div.className="card";
    div.style.marginTop="20px";

    let actions="";

    if(b.status==="pending"){
      actions=`
        <button class="next-btn" onclick="confirmBooking(${b.id})">‚úî –ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏</button>
        <button class="next-btn" style="background:#ef4444" onclick="cancelBooking(${b.id})">‚úñ –°–∫–∞—Å—É–≤–∞—Ç–∏</button>
      `;
    }

    div.innerHTML=`
      <b>${b.client_name}</b><br>
      üìû ${b.phone}<br>
      ‚úÇÔ∏è ${b.service}<br>
      üïí ${b.datetime}<br>
      <b>–°—Ç–∞—Ç—É—Å: ${b.status}</b><br><br>
      ${actions}
    `;

    container.appendChild(div);
  });
}

async function confirmBooking(id){
  await fetch(`/booking/${id}/confirm`,{
    method:"PUT",
    credentials:"include"
  });
  loadBookings();
}

async function cancelBooking(id){
  await fetch(`/booking/${id}/cancel`,{
    method:"PUT",
    credentials:"include"
  });
  loadBookings();
}

loadBookings();
</script>

</body>
</html>