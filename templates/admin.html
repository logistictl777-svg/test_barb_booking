<a href="/calendar">üìÖ –ö–∞–ª–µ–Ω–¥–∞—Ä –∑–∞–ø–∏—Å—ñ–≤</a>
<br><br>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>–ê–¥–º—ñ–Ω –ø–∞–Ω–µ–ª—å</title>

<style>
body{font-family:Arial;padding:40px;background:#0f172a;color:#e2e8f0}
a{color:#38bdf8}

.filters{margin:20px 0;display:flex;gap:10px}
.filters button{background:#334155;color:white;padding:8px 14px;border-radius:8px}
.filters button.active{background:#38bdf8}

.stats{display:flex;gap:20px;margin:25px 0}
.stat-card{background:#1e293b;padding:15px 25px;border-radius:12px}
.stat-card h3{margin:0;font-size:28px}
.stat-card p{margin:5px 0 0;color:#94a3b8}

.booking-card{
 background:#1e293b;border:1px solid #334155;
 padding:15px;margin:12px 0;border-radius:12px;width:360px;
}

.admin-buttons{display:flex;gap:10px;margin-top:12px}
button{border:none;padding:6px 12px;border-radius:8px;cursor:pointer}
.confirm{background:#22c55e;color:white}
.cancel{background:#f59e0b;color:white}
.delete{background:#ef4444;color:white}

.status-confirmed{color:#4ade80;font-weight:bold}
.status-pending{color:#facc15;font-weight:bold}
.status-cancelled{color:#f87171;font-weight:bold}

#toast{position:fixed;top:20px;right:20px;z-index:999}
.toast-msg{background:#1e293b;color:white;padding:12px 18px;margin-bottom:10px;border-radius:10px}
.toast-success{border-left:5px solid #22c55e}
.toast-error{border-left:5px solid #ef4444}
</style>
</head>

<body>

<h1>üìä –ê–¥–º—ñ–Ω –ø–∞–Ω–µ–ª—å –∑–∞–ø–∏—Å—ñ–≤</h1>
<a href="/">‚¨ÖÔ∏è –ù–∞ –≥–æ–ª–æ–≤–Ω—É</a>

<div class="filters">
<button onclick="setFilter('all')">–£—Å—ñ</button>
<button onclick="setFilter('pending')">–û—á—ñ–∫—É—é—Ç—å</button>
<button onclick="setFilter('confirmed')">–ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω—ñ</button>
<button onclick="setFilter('cancelled')">–°–∫–∞—Å–æ–≤–∞–Ω—ñ</button>
<button onclick="setFilter('today')">–°—å–æ–≥–æ–¥–Ω—ñ</button>
</div>

<input id="searchInput" placeholder="üîç –ü–æ—à—É–∫ –ø–æ —ñ–º–µ–Ω—ñ –∞–±–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É..." oninput="loadAdminBookings()"
style="margin-top:15px;padding:10px;width:350px;border-radius:8px;border:none;background:#1e293b;color:white">

<input type="date" id="datePicker" onchange="loadAdminBookings()"
style="margin-top:10px;padding:10px;border-radius:8px;border:none;background:#1e293b;color:white">

<div id="stats" class="stats"></div>
<div id="bookings"></div>
<div id="toast"></div>

<script>
let currentFilter="all";
loadAdminBookings();

function showToast(text,type="success"){
 const msg=document.createElement("div");
 msg.className=`toast-msg toast-${type}`;
 msg.innerText=text;
 document.getElementById("toast").appendChild(msg);
 setTimeout(()=>msg.remove(),2500);
}

function getStatusUA(status){
 if(status==="pending")return"–û—á—ñ–∫—É—î –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è";
 if(status==="confirmed")return"–ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ";
 if(status==="cancelled")return"–°–∫–∞—Å–æ–≤–∞–Ω–æ";
 return status;
}

function setFilter(filter){
 currentFilter=filter;
 loadAdminBookings();
}

function renderStats(bookings){
 const today=new Date().toDateString();
 const tomorrowDate=new Date();tomorrowDate.setDate(tomorrowDate.getDate()+1);
 const tomorrow=tomorrowDate.toDateString();

 document.getElementById("stats").innerHTML=`
  <div class="stat-card"><h3>${bookings.filter(b=>new Date(b.datetime).toDateString()===today).length}</h3><p>–°—å–æ–≥–æ–¥–Ω—ñ</p></div>
  <div class="stat-card"><h3>${bookings.filter(b=>new Date(b.datetime).toDateString()===tomorrow).length}</h3><p>–ó–∞–≤—Ç—Ä–∞</p></div>
  <div class="stat-card"><h3>${bookings.filter(b=>b.status==="pending").length}</h3><p>–û—á—ñ–∫—É—é—Ç—å</p></div>
  <div class="stat-card"><h3>${bookings.length}</h3><p>–£—Å—å–æ–≥–æ</p></div>
 `;
}

async function loadAdminBookings(){
 const res=await fetch("/admin/bookings",{credentials:"include"});
 if(res.status!==200){document.getElementById("bookings").innerHTML="–ù–µ–º–∞ –¥–æ—Å—Ç—É–ø—É";return;}

 let bookings=await res.json();
 renderStats(bookings);

 const searchInput=document.getElementById("searchInput");
 const search=searchInput?searchInput.value.toLowerCase():"";
 if(search){
  bookings=bookings.filter(b=>b.client_name.toLowerCase().includes(search)||b.phone.toLowerCase().includes(search));
 }

 const dateInput=document.getElementById("datePicker");
 const selectedDate=dateInput?dateInput.value:"";
 if(selectedDate){
  bookings=bookings.filter(b=>new Date(b.datetime).toISOString().split("T")[0]===selectedDate);
 }

 if(currentFilter==="pending")bookings=bookings.filter(b=>b.status==="pending");
 if(currentFilter==="confirmed")bookings=bookings.filter(b=>b.status==="confirmed");
 if(currentFilter==="cancelled")bookings=bookings.filter(b=>b.status==="cancelled");
 if(currentFilter==="today"){
   const today=new Date().toDateString();
   bookings=bookings.filter(b=>new Date(b.datetime).toDateString()===today);
 }

 const container=document.getElementById("bookings");
 container.innerHTML="";

 const today=new Date().toDateString();
 const tomorrowDate=new Date();tomorrowDate.setDate(tomorrowDate.getDate()+1);
 const tomorrow=tomorrowDate.toDateString();

 let todayList=[],tomorrowList=[],futureList=[];
 bookings.forEach(b=>{
  const d=new Date(b.datetime).toDateString();
  if(d===today)todayList.push(b);
  else if(d===tomorrow)tomorrowList.push(b);
  else futureList.push(b);
 });

 function renderSection(title,list){
  if(list.length===0)return;
  container.innerHTML+=`<h2 style="margin-top:30px">${title}</h2>`;
  list.forEach(b=>{
   container.innerHTML+=`
   <div class="booking-card">
     <p><b>ID:</b> ${b.id}</p>
     <p><b>–Ü–º'—è:</b> ${b.client_name}</p>
     <p><b>–¢–µ–ª–µ—Ñ–æ–Ω:</b> ${b.phone}</p>
     <p><b>–ü–æ—Å–ª—É–≥–∞:</b> ${b.service}</p>
     <p><b>–î–∞—Ç–∞:</b> ${new Date(b.datetime).toLocaleString()}</p>
     <p><b>–°—Ç–∞—Ç—É—Å:</b> <span class="status-${b.status}">${getStatusUA(b.status)}</span></p>
     <div class="admin-buttons">
      <button class="confirm" onclick="confirmBooking(${b.id})">‚úî</button>
      <button class="cancel" onclick="cancelBooking(${b.id})">‚úñ</button>
      <button class="delete" onclick="deleteBooking(${b.id})">üóë</button>
     </div>
   </div>`;
  });
 }

 renderSection("üìÖ –°—å–æ–≥–æ–¥–Ω—ñ",todayList);
 renderSection("üìÖ –ó–∞–≤—Ç—Ä–∞",tomorrowList);
 renderSection("üìÖ –ú–∞–π–±—É—Ç–Ω—ñ –∑–∞–ø–∏—Å–∏",futureList);
}

async function confirmBooking(id){
 await fetch(`/booking/${id}/confirm`,{method:"PUT",credentials:"include"});
 showToast("–ó–∞–ø–∏—Å –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ ‚úî");
 loadAdminBookings();
}
async function cancelBooking(id){
 await fetch(`/booking/${id}/cancel`,{method:"PUT",credentials:"include"});
 showToast("–ó–∞–ø–∏—Å —Å–∫–∞—Å–æ–≤–∞–Ω–æ","error");
 loadAdminBookings();
}
async function deleteBooking(id){
 await fetch(`/booking/${id}`,{method:"DELETE",credentials:"include"});
 showToast("–ó–∞–ø–∏—Å –≤–∏–¥–∞–ª–µ–Ω–æ","error");
 loadAdminBookings();
}
</script>

</body>
</html>