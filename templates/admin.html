<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>Admin panel</title>
<link rel="stylesheet" href="{{ url_for('static', path='style.css') }}">
</head>

<body>

<header class="header">
    <div class="logo">üîê Admin panel</div>
    <a href="/" class="admin-link">–ù–∞ —Å–∞–π—Ç</a>
</header>

<section class="booking-container">
<div class="booking-card">

<h2>–£—Å—ñ –∑–∞–ø–∏—Å–∏</h2>
<div id="bookings"></div>

</div>
</section>

<script>
async function loadBookings(){
    const res = await fetch("/admin/bookings");
    const data = await res.json();

    const box = document.getElementById("bookings");
    box.innerHTML = "";

    data.forEach(b => {
        const div = document.createElement("div");
        div.className="card";
        div.style.marginTop="20px";

        let buttons = "";

        if(b.status === "pending"){
            buttons = `
                <button onclick="confirmBooking(${b.id})" class="next-btn">‚úî –ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏</button>
                <button onclick="cancelBooking(${b.id})" class="next-btn" style="background:#ef4444">‚úñ –°–∫–∞—Å—É–≤–∞—Ç–∏</button>
            `;
        }

        div.innerHTML = `
            <b>${b.client_name}</b><br>
            üìû ${b.phone}<br>
            ‚úÇÔ∏è ${b.service}<br>
            üïí ${b.datetime}<br>
            <b>–°—Ç–∞—Ç—É—Å: ${b.status}</b><br>
            ${buttons}
        `;

        box.appendChild(div);
    });
}

async function confirmBooking(id){
    await fetch(`/booking/${id}/confirm`, {method:"PUT"});
    loadBookings();
}

async function cancelBooking(id){
    await fetch(`/booking/${id}/cancel`, {method:"PUT"});
    loadBookings();
}

loadBookings();
</script>

</body>
</html>