<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>Barber Booking</title>
<link rel="stylesheet" href="/static/style.css">
</head>

<body>

<header class="header">
    <div class="logo">üíà BarberShop</div>
    <a href="/admin" class="admin-link">Admin login</a>
</header>

<section class="hero">
    <h1>–ó–∞–ø–∏—à–∏—Å—å –¥–æ –±–∞—Ä–±–µ—Ä–∞ –æ–Ω–ª–∞–π–Ω üíà</h1>
    <p>–û–±–µ—Ä–∏ –ø–æ—Å–ª—É–≥—É —Ç–∞ —á–∞—Å –∑–∞ 30 —Å–µ–∫—É–Ω–¥ –±–µ–∑ –¥–∑–≤—ñ–Ω–∫—ñ–≤</p>
    <button class="cta-btn" onclick="scrollToBooking()">–ó–∞–ø–∏—Å–∞—Ç–∏—Å—è –∑–∞—Ä–∞–∑</button>
</section>

<section id="booking" class="booking-container">
<div class="booking-card">

<div class="progress">Service ‚Üí Date ‚Üí Time ‚Üí Confirm</div>

<h2>–û–±–µ—Ä—ñ—Ç—å –ø–æ—Å–ª—É–≥—É</h2>

<div class="services-grid">
  <div class="service-card" onclick="selectService(this,'–°—Ç—Ä–∏–∂–∫–∞')">
    –°—Ç—Ä–∏–∂–∫–∞
    <span>30 —Ö–≤ ¬∑ 25‚Ç¨</span>
  </div>

  <div class="service-card" onclick="selectService(this,'–ë–æ—Ä–æ–¥–∞')">
    –ë–æ—Ä–æ–¥–∞
    <span>20 —Ö–≤ ¬∑ 15‚Ç¨</span>
  </div>

  <div class="service-card popular" onclick="selectService(this,'–°—Ç—Ä–∏–∂–∫–∞ + –ë–æ—Ä–æ–¥–∞')">
    Combo üî•
    <span>45 —Ö–≤ ¬∑ 35‚Ç¨</span>
  </div>
</div>

<input type="hidden" id="service">

<h2>–í–∞—à—ñ –∫–æ–Ω—Ç–∞–∫—Ç–∏</h2>
<input id="name" placeholder="–í–∞—à–µ —ñ–º'—è">
<input id="phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω">

<h2>–û–±–µ—Ä—ñ—Ç—å –¥–∞—Ç—É</h2>
<input id="date" type="date">

<h2>–û–±–µ—Ä—ñ—Ç—å —á–∞—Å</h2>
<div id="timeSlots"></div>
<input type="hidden" id="selectedTime">

<button class="next-btn" onclick="createBooking()">–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –∑–∞–ø–∏—Å</button>
<div id="messageBox" style="display:none" class="success-msg"></div>

</div>
</section>

<script>
function scrollToBooking(){
 document.getElementById("booking").scrollIntoView({behavior:'smooth'});
}

let messageTimer=null;

function selectService(el,service){
 document.getElementById("service").value=service;
 document.querySelectorAll(".service-card").forEach(c=>c.style.border="1px solid #1e293b");
 el.style.border="2px solid #22c55e";
}

const today=new Date();
const maxDate=new Date();
maxDate.setDate(today.getDate()+30);
document.getElementById("date").min=today.toISOString().split("T")[0];
document.getElementById("date").max=maxDate.toISOString().split("T")[0];

function showMessage(text){
 const box=document.getElementById("messageBox");
 box.innerText=text;
 box.style.display="block";
 clearTimeout(messageTimer);
 messageTimer=setTimeout(()=>box.style.display="none",2500);
}

async function loadTimes(){
 const date=document.getElementById("date").value;
 if(!date) return;

 const day=new Date(date).getDay();
 const container=document.getElementById("timeSlots");
 container.innerHTML="";

 if(day===0){
   container.innerHTML="<p>–£ –Ω–µ–¥—ñ–ª—é –±–∞—Ä–±–µ—Ä –Ω–µ –ø—Ä–∞—Ü—é—î üò¥</p>";
   return;
 }

 const res=await fetch(`/available-times?date=${date}`);
 const times=await res.json();

 times.forEach(t=>{
   const div=document.createElement("div");
   div.className="time-slot";
   div.innerText=t;
   div.onclick=()=>selectTime(t,div);
   container.appendChild(div);
 });
}

function selectTime(time,el){
 document.querySelectorAll(".time-slot").forEach(x=>x.classList.remove("selected"));
 el.classList.add("selected");
 document.getElementById("selectedTime").value=time;
}

document.getElementById("date").addEventListener("change",loadTimes);

async function createBooking(){
 const name=document.getElementById("name").value;
 const phone=document.getElementById("phone").value;
 const service=document.getElementById("service").value;
 const date=document.getElementById("date").value;
 const time=document.getElementById("selectedTime").value;

 if(!service){showMessage("–û–±–µ—Ä—ñ—Ç—å –ø–æ—Å–ª—É–≥—É üíà");return;}
 if(!time){showMessage("–û–±–µ—Ä—ñ—Ç—å —á–∞—Å ‚è∞");return;}

 const datetime=date+"T"+time;

 const res=await fetch("/book",{
  method:"POST",
  headers:{"Content-Type":"application/json"},
  body:JSON.stringify({client_name:name,phone:phone,service:service,datetime:datetime})
 });

 const data=await res.json();
 if(!res.ok){showMessage(data.detail);return;}

 showMessage("–í–∏ –∑–∞–ø–∏—Å–∞–Ω—ñ üéâ");
 loadTimes();
}
</script>

</body>
</html>